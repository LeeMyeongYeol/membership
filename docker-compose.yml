version: '3.8'

services:
  # 1. 백엔드 API 서비스
  api:
    # backend 디렉토리의 Dockerfile을 사용하여 빌드
    build:
      context: ./backend
      dockerfile: Dockerfile
    # 컨테이너 이름
    container_name: movie-reco-api
    # .env 파일의 환경 변수를 컨테이너 내부로 주입
    env_file:
      - .env
    ports:
      # 호스트의 8000번 포트를 컨테이너의 8000번 포트와 연결
      - "8000:8000"
    volumes:
      # 로컬 백엔드 코드를 컨테이너와 동기화 (개발 시 유용)
      - ./backend:/app
    restart: always
    networks:
      - movie-network

  # 2. 프론트엔드 서비스 (React + Vite + Nginx)
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: movie-reco-frontend
    ports:
      - "3000:80"
    depends_on:
      - api
    restart: always
    networks:
      - movie-network

networks:
  movie-network:
    driver: bridge
