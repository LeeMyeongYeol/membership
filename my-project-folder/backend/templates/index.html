<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì˜í™” ì·¨í–¥ ë¶„ì„ ì¶”ì²œ | TMDb + OMDb + TFâ€‘IDF</title>
  <style>
    :root { --bg:#0b1020; --card:#121a33; --ink:#e7ecff; --muted:#9fb0ff; --accent:#6ea8ff; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Apple SD Gothic Neo, 'Malgun Gothic', sans-serif; background: var(--bg); color: var(--ink); }
    header { padding: 24px; border-bottom: 1px solid #22305b; }
    .container { max-width: 1100px; margin: 0 auto; padding: 24px; }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .card { background: var(--card); border:1px solid #22305b; border-radius:16px; padding: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.25);}    
    textarea, select, input[type=text] { width:100%; background:#0c1730; color: var(--ink); border:1px solid #243356; border-radius: 12px; padding:12px; }
    button { background: linear-gradient(135deg, #3b82f6, #2563eb); border:none; color:white; padding:12px 16px; border-radius:12px; font-weight:700; cursor:pointer; }
    button:disabled { opacity:.5; cursor:not-allowed; }
    .hint { color: var(--muted); font-size: 13px; }
    .pill { background:#0b1430; border:1px solid #243356; padding:6px 10px; border-radius:999px; margin-right:6px; display:inline-block; color:#cfe0ff; }
    .poster { width:100%; border-radius:12px; }
    .rec-grid { display:grid; grid-template-columns: repeat(5, 1fr); gap:14px; }
    .rec { background:#0d1530; border:1px solid #22305b; border-radius:14px; overflow:hidden; display:flex; flex-direction:column; }
    .rec .info { padding:10px; font-size: 14px; line-height:1.35; }
    .badge { font-size: 12px; color:#bcd2ff; border:1px solid #2a3d6f; padding:4px 6px; border-radius:8px; display:inline-block; margin-right:6px; }
    .row { display:flex; gap:10px; align-items:center; flex-wrap: wrap; }
    .features span { background:#101b3d; border:1px dashed #2a3d6f; border-radius:10px; padding:6px 8px; margin:4px; font-size:13px;}
    footer { text-align:center; padding:24px; color:#5d79b9; }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1 style="margin:0 0 6px 0;">ğŸ¬ ì˜í™” ì·¨í–¥ ë¶„ì„ ì¶”ì²œ</h1>
      <div class="hint">TMDb + OMDb + Python TFâ€‘IDFë¡œ ë‚´ê°€ ì¢‹ì•„í•  ì˜í™”ë¥¼ ì°¾ì•„ì¤ë‹ˆë‹¤.</div>
      <div class="hint">TMDb í‚¤: <b>{{ 'OK' if has_tmdb else 'ë¯¸ì„¤ì •' }}</b> Â· OMDb í‚¤: <b>{{ 'OK' if has_omdb else 'ë¯¸ì„¤ì •' }}</b></div>
    </div>
  </header>

  <div class="container">
    <div class="grid">
      <div class="card">
        <h3>1) ì¢‹ì•„í•˜ëŠ” ì˜í™” ì œëª© (í•œ ì¤„ì— 1ê°œ)</h3>
        <textarea id="titles" rows="10" placeholder="ì˜ˆ) ê¸°ìƒì¶©&#10;ì¸ì…‰ì…˜&#10;ë¼ë¼ëœë“œ&#10;ì–´ë°”ì›ƒ íƒ€ì„&#10;ì¸í„°ìŠ¤í…”ë¼&#10;ì•”ì‚´&#10;í—¤ì–´ì§ˆ ê²°ì‹¬"></textarea>
        <div class="row" style="margin-top:10px;">
          <div style="flex:1;">
            <label class="hint">ì–¸ì–´ (TMDb ì‘ë‹µ ì–¸ì–´)</label>
            <select id="lang">
              <option value="ko-KR" selected>í•œêµ­ì–´ (ko-KR)</option>
              <option value="en-US">ì˜ì–´ (en-US)</option>
              <option value="ja-JP">ì¼ë³¸ì–´ (ja-JP)</option>
            </select>
          </div>
          <div>
            <button id="run">ë¶„ì„ & ì¶”ì²œ ì‹¤í–‰</button>
          </div>
        </div>
        <p class="hint" style="margin-top:10px;">* ì„œë²„ì˜ .envì— TMDB_API_KEY, OMDB_API_KEYë¥¼ ë„£ì–´ë‘ë©´ ìë™ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
      </div>

      <div class="card">
        <h3>2) ê°ì§€ëœ ê³µí†µ íŒ¨í„´ (Top 10 TFâ€‘IDF íŠ¹ì§•)</h3>
        <div id="features" class="features"></div>
        <div style="height:8px;"></div>
        <div class="row">
          <div id="genres"></div>
        </div>
        <div style="height:8px;"></div>
        <div class="row">
          <div id="directors"></div>
        </div>
        <div style="height:8px;"></div>
        <div class="row">
          <div id="actors"></div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:20px;">
      <h3>3) ë§ì¶¤ ì¶”ì²œ</h3>
      <div id="recs" class="rec-grid"></div>
      <div id="error" class="hint" style="color:#ff9c9c;"></div>
    </div>
  </div>

  <footer>Â© TFâ€‘IDF Recommender â€¢ TMDb/OMDb ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</footer>

  <script>
    const $ = (sel) => document.querySelector(sel);

    function chipList(el, title, arr) {
      if (!arr || !arr.length) { el.innerHTML = ''; return; }
      el.innerHTML = `<div class="pill">${title}</div>` + arr.map(([k,v]) => `<span class="pill">${k} Ã— ${v}</span>`).join('');
    }

    function featureList(el, arr) {
      if (!arr || !arr.length) { el.innerHTML = '<div class="hint">(íŒ¨í„´ì´ ì•„ì§ ì—†ìŠµë‹ˆë‹¤)</div>'; return; }
      el.innerHTML = arr.map(([k,score]) => `<span>${k} <small style="opacity:.6">${score.toFixed(3)}</small></span>`).join('');
    }

    function recCard(item) {
      const poster = item.poster ? `<img class="poster" loading="lazy" src="${item.poster}" alt="${item.title}">` : `<div style="height:180px; background:#0b1430"></div>`;
      const genres = (item.genres||[]).map(g=>`<span class="badge">${g}</span>`).join('');
      const extra = [
        item.release_date ? `ê°œë´‰ ${item.release_date}` : null,
        item.runtime ? `${item.runtime}ë¶„` : null,
        item.vote_average ? `TMDb â˜…${item.vote_average.toFixed(1)} (${item.vote_count||0})` : null,
        item.omdb?.imdbRating ? `IMDb â˜…${item.omdb.imdbRating}` : null,
        item.omdb?.metascore ? `Metascore ${item.omdb.metascore}` : null,
      ].filter(Boolean).join(' Â· ');
      return `
        <div class="rec">
          ${poster}
          <div class="info">
            <div style="font-weight:700; margin-bottom:6px;">${item.title}</div>
            <div class="row" style="margin-bottom:6px;">${genres}</div>
            <div class="hint" style="margin-bottom:6px;">${extra}</div>
            <div style="font-size:13px; opacity:.9;">${(item.overview||'').slice(0,180)}${(item.overview||'').length>180?'â€¦':''}</div>
          </div>
        </div>`;
    }

    async function runAnalyze() {
      $('#error').textContent = '';
      $('#recs').innerHTML = '';
      $('#features').innerHTML = '';
      $('#genres').innerHTML = '';
      $('#directors').innerHTML = '';
      $('#actors').innerHTML = '';

      const titles = $('#titles').value.split('\n').map(s=>s.trim()).filter(Boolean);
      if (!titles.length) {
        $('#error').textContent = 'ì˜í™” ì œëª©ì„ í•œ ê°œ ì´ìƒ ì…ë ¥í•˜ì„¸ìš”.';
        return;
      }

      $('#run').disabled = true; $('#run').textContent = 'ë¶„ì„ ì¤‘â€¦';
      try {
        const resp = await fetch('/api/analyze', {
          method: 'POST', headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ titles, language: $('#lang').value })
        });
        const data = await resp.json();
        if (!resp.ok) { throw new Error(data.error || 'ìš”ì²­ ì‹¤íŒ¨'); }

        featureList($('#features'), data.top_features);
        chipList($('#genres'), 'Top ì¥ë¥´', data.top_genres);
        chipList($('#directors'), 'Top ê°ë…', data.top_directors);
        chipList($('#actors'), 'Top ë°°ìš°', data.top_actors);

        $('#recs').innerHTML = data.recommendations.map(recCard).join('');
      } catch (e) {
        $('#error').textContent = e.message || String(e);
      } finally {
        $('#run').disabled = false; $('#run').textContent = 'ë¶„ì„ & ì¶”ì²œ ì‹¤í–‰';
      }
    }

    $('#run').addEventListener('click', runAnalyze);
  </script>
</body>
</html>
